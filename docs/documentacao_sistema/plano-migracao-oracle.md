# üöÄ Plano de Migra√ß√£o: Mock para APIs REST com Oracle 19c

## üìã **Informa√ß√µes da Configura√ß√£o Oracle**

**Baseado na configura√ß√£o visualizada:**
- **Host:** localhost
- **Port:** 1521
- **Database:** xe (Oracle Express Edition)
- **Authentication:** Oracle Database Native
- **Username:** system
- **Client:** OraDB21Home1
- **Driver:** Oracle

---

## üéØ **Objetivo da Migra√ß√£o**

Migrar o sistema atual que utiliza **localStorage** (mock-backend) para um sistema completo com **APIs REST** conectadas ao **Oracle 19c**, mantendo todas as funcionalidades existentes.

---

## üìä **An√°lise do Estado Atual**

### **Sistema Mock Atual**
- **Arquivo:** `src/lib/mock-backend.ts`
- **Armazenamento:** localStorage do navegador
- **Funcionalidades:** CRUD completo para 7 m√≥dulos
- **Dados:** Simulados em mem√≥ria/localStorage

### **M√≥dulos com CRUD Implementado**
1. ‚úÖ **Tramita√ß√£o** - Sistema de controle de tramita√ß√£o
2. ‚úÖ **Encomendas** - Gest√£o de encomendas e pedidos
3. ‚úÖ **Arquivo** - Sistema de arquivamento digital
4. ‚úÖ **Prazos** - Controle de prazos e vencimentos
5. ‚úÖ **Usu√°rios** - Gest√£o de usu√°rios e permiss√µes
6. ‚úÖ **Processos** - Sistema principal de processos
7. ‚úÖ **Documentos** - Gest√£o avan√ßada de documentos

---

## üèóÔ∏è **Arquitetura da Solu√ß√£o**

### **Stack Tecnol√≥gica Proposta**

#### **Backend (Novo)**
- **Runtime:** Node.js 18+
- **Framework:** Express.js ou Fastify
- **ORM/Query Builder:** Knex.js ou TypeORM
- **Driver Oracle:** oracledb (node-oracledb)
- **Autentica√ß√£o:** JWT + bcrypt
- **Valida√ß√£o:** Joi ou Zod
- **Documenta√ß√£o:** Swagger/OpenAPI

#### **Frontend (Existente)**
- **Framework:** React 18 + TypeScript
- **HTTP Client:** Axios ou Fetch API
- **Estado:** React Context + useState/useReducer
- **Formul√°rios:** React Hook Form

---

## üìã **Plano de Execu√ß√£o**

### **Fase 1: Prepara√ß√£o do Ambiente (5 dias)**

#### **1.1 Configura√ß√£o do Banco Oracle**
```sql
-- Criar usu√°rio espec√≠fico para a aplica√ß√£o
CREATE USER protocolo_user IDENTIFIED BY "senha_segura";
GRANT CONNECT, RESOURCE TO protocolo_user;
GRANT CREATE SESSION TO protocolo_user;
GRANT CREATE TABLE TO protocolo_user;
GRANT CREATE SEQUENCE TO protocolo_user;
GRANT CREATE TRIGGER TO protocolo_user;

-- Conceder quota no tablespace
ALTER USER protocolo_user QUOTA UNLIMITED ON USERS;
```

#### **1.2 Estrutura do Projeto Backend**
```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ environment.ts
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tramitacao.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ encomendas.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ arquivo.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prazos.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuarios.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processos.controller.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ documentos.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tramitacao.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ encomendas.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ arquivo.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prazos.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuarios.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processos.model.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ documentos.model.ts
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.routes.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.middleware.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.middleware.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers.ts
‚îÇ   ‚îî‚îÄ‚îÄ app.ts
‚îú‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ seeds/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ .env
```

### **Fase 2: Modelagem do Banco de Dados (3 dias)**

#### **2.1 Tabelas Principais**

```sql
-- Tabela de Usu√°rios
CREATE TABLE usuarios (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) UNIQUE NOT NULL,
    senha VARCHAR2(255) NOT NULL,
    perfil VARCHAR2(50) NOT NULL,
    ativo NUMBER(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Processos
CREATE TABLE processos (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    numero VARCHAR2(50) UNIQUE NOT NULL,
    assunto VARCHAR2(255) NOT NULL,
    descricao CLOB,
    status VARCHAR2(50) NOT NULL,
    prioridade VARCHAR2(20) NOT NULL,
    usuario_id NUMBER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Documentos
CREATE TABLE documentos (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    titulo VARCHAR2(255) NOT NULL,
    tipo VARCHAR2(50) NOT NULL,
    categoria VARCHAR2(100),
    arquivo_nome VARCHAR2(255),
    arquivo_path VARCHAR2(500),
    arquivo_size NUMBER,
    mime_type VARCHAR2(100),
    versao NUMBER DEFAULT 1,
    processo_id NUMBER REFERENCES processos(id),
    usuario_id NUMBER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Tramita√ß√£o
CREATE TABLE tramitacao (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    processo_id NUMBER REFERENCES processos(id),
    origem VARCHAR2(100) NOT NULL,
    destino VARCHAR2(100) NOT NULL,
    observacoes CLOB,
    status VARCHAR2(50) NOT NULL,
    usuario_id NUMBER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Encomendas
CREATE TABLE encomendas (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    codigo VARCHAR2(50) UNIQUE NOT NULL,
    descricao VARCHAR2(255) NOT NULL,
    fornecedor VARCHAR2(100),
    valor NUMBER(10,2),
    status VARCHAR2(50) NOT NULL,
    data_pedido DATE,
    data_entrega DATE,
    usuario_id NUMBER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Prazos
CREATE TABLE prazos (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    titulo VARCHAR2(255) NOT NULL,
    descricao CLOB,
    data_inicio DATE NOT NULL,
    data_fim DATE NOT NULL,
    status VARCHAR2(50) NOT NULL,
    prioridade VARCHAR2(20) NOT NULL,
    processo_id NUMBER REFERENCES processos(id),
    usuario_id NUMBER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Arquivo
CREATE TABLE arquivo (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR2(255) NOT NULL,
    tipo VARCHAR2(50) NOT NULL,
    categoria VARCHAR2(100),
    tags VARCHAR2(500),
    arquivo_path VARCHAR2(500),
    arquivo_size NUMBER,
    mime_type VARCHAR2(100),
    nivel_acesso VARCHAR2(50) DEFAULT 'publico',
    usuario_id NUMBER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### **Fase 3: Desenvolvimento das APIs (10 dias)**

#### **3.1 Configura√ß√£o da Conex√£o Oracle**

```typescript
// src/config/database.ts
import oracledb from 'oracledb';

interface DatabaseConfig {
  user: string;
  password: string;
  connectString: string;
  poolMin: number;
  poolMax: number;
  poolIncrement: number;
}

const dbConfig: DatabaseConfig = {
  user: process.env.DB_USER || 'protocolo_user',
  password: process.env.DB_PASSWORD || 'senha_segura',
  connectString: process.env.DB_CONNECT_STRING || 'localhost:1521/xe',
  poolMin: 2,
  poolMax: 10,
  poolIncrement: 1
};

export class DatabaseService {
  private static pool: oracledb.Pool;

  static async initialize(): Promise<void> {
    try {
      this.pool = await oracledb.createPool(dbConfig);
      console.log('‚úÖ Conex√£o com Oracle estabelecida');
    } catch (error) {
      console.error('‚ùå Erro ao conectar com Oracle:', error);
      throw error;
    }
  }

  static async getConnection(): Promise<oracledb.Connection> {
    return await this.pool.getConnection();
  }

  static async close(): Promise<void> {
    if (this.pool) {
      await this.pool.close();
    }
  }
}
```

#### **3.2 Estrutura dos Endpoints**

```typescript
// Exemplo: src/controllers/processos.controller.ts
import { Request, Response } from 'express';
import { DatabaseService } from '../config/database';

export class ProcessosController {
  // GET /api/processos
  static async getAll(req: Request, res: Response) {
    const connection = await DatabaseService.getConnection();
    try {
      const result = await connection.execute(
        `SELECT p.*, u.nome as usuario_nome 
         FROM processos p 
         LEFT JOIN usuarios u ON p.usuario_id = u.id 
         ORDER BY p.created_at DESC`
      );
      
      res.json({
        success: true,
        data: result.rows,
        total: result.rows?.length || 0
      });
    } catch (error) {
      res.status(500).json({ success: false, error: error.message });
    } finally {
      await connection.close();
    }
  }

  // POST /api/processos
  static async create(req: Request, res: Response) {
    const connection = await DatabaseService.getConnection();
    try {
      const { numero, assunto, descricao, status, prioridade, usuario_id } = req.body;
      
      const result = await connection.execute(
        `INSERT INTO processos (numero, assunto, descricao, status, prioridade, usuario_id) 
         VALUES (:numero, :assunto, :descricao, :status, :prioridade, :usuario_id) 
         RETURNING id INTO :id`,
        {
          numero, assunto, descricao, status, prioridade, usuario_id,
          id: { dir: oracledb.BIND_OUT, type: oracledb.NUMBER }
        },
        { autoCommit: true }
      );
      
      res.status(201).json({
        success: true,
        data: { id: result.outBinds.id[0], ...req.body }
      });
    } catch (error) {
      res.status(500).json({ success: false, error: error.message });
    } finally {
      await connection.close();
    }
  }

  // PUT /api/processos/:id
  static async update(req: Request, res: Response) {
    // Implementa√ß√£o similar...
  }

  // DELETE /api/processos/:id
  static async delete(req: Request, res: Response) {
    // Implementa√ß√£o similar...
  }
}
```

### **Fase 4: Integra√ß√£o Frontend (5 dias)**

#### **4.1 Configura√ß√£o do Cliente HTTP**

```typescript
// src/lib/api-client.ts
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Interceptor para adicionar token de autentica√ß√£o
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('auth_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Interceptor para tratar erros
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('auth_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

#### **4.2 Substitui√ß√£o do Mock Backend**

```typescript
// src/lib/real-backend.ts
import { apiClient } from './api-client';

export class RealBackend {
  // Processos
  static async getProcessos() {
    const response = await apiClient.get('/processos');
    return response.data;
  }

  static async createProcesso(data: any) {
    const response = await apiClient.post('/processos', data);
    return response.data;
  }

  static async updateProcesso(id: string, data: any) {
    const response = await apiClient.put(`/processos/${id}`, data);
    return response.data;
  }

  static async deleteProcesso(id: string) {
    const response = await apiClient.delete(`/processos/${id}`);
    return response.data;
  }

  // Documentos
  static async getDocumentos() {
    const response = await apiClient.get('/documentos');
    return response.data;
  }

  static async uploadDocumento(formData: FormData) {
    const response = await apiClient.post('/documentos/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    });
    return response.data;
  }

  // ... outros m√©todos para todos os m√≥dulos
}
```

### **Fase 5: Autentica√ß√£o e Seguran√ßa (3 dias)**

#### **5.1 Sistema de Autentica√ß√£o JWT**

```typescript
// src/middleware/auth.middleware.ts
import jwt from 'jsonwebtoken';
import { Request, Response, NextFunction } from 'express';

interface AuthRequest extends Request {
  user?: any;
}

export const authMiddleware = (req: AuthRequest, res: Response, next: NextFunction) => {
  const token = req.header('Authorization')?.replace('Bearer ', '');

  if (!token) {
    return res.status(401).json({ success: false, message: 'Token n√£o fornecido' });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET || 'secret');
    req.user = decoded;
    next();
  } catch (error) {
    res.status(401).json({ success: false, message: 'Token inv√°lido' });
  }
};
```

### **Fase 6: Testes e Deploy (4 dias)**

#### **6.1 Testes de Integra√ß√£o**
- Testes de conex√£o com Oracle
- Testes de CRUD para todos os m√≥dulos
- Testes de autentica√ß√£o
- Testes de upload de arquivos

#### **6.2 Configura√ß√£o de Deploy**
- Configura√ß√£o de vari√°veis de ambiente
- Scripts de migra√ß√£o do banco
- Configura√ß√£o de proxy reverso (Nginx)
- Monitoramento e logs

---

## üìã **Checklist de Migra√ß√£o**

### **Prepara√ß√£o**
- [ ] Configurar Oracle 19c
- [ ] Criar usu√°rio e permiss√µes
- [ ] Configurar ambiente de desenvolvimento
- [ ] Instalar depend√™ncias do backend

### **Banco de Dados**
- [ ] Criar estrutura de tabelas
- [ ] Configurar √≠ndices e constraints
- [ ] Criar triggers de auditoria
- [ ] Migrar dados do localStorage (se necess√°rio)

### **Backend**
- [ ] Configurar conex√£o Oracle
- [ ] Implementar controllers para todos os m√≥dulos
- [ ] Implementar middleware de autentica√ß√£o
- [ ] Configurar upload de arquivos
- [ ] Implementar valida√ß√µes
- [ ] Configurar logs e monitoramento

### **Frontend**
- [ ] Configurar cliente HTTP
- [ ] Substituir mock backend
- [ ] Implementar sistema de autentica√ß√£o
- [ ] Testar todas as funcionalidades
- [ ] Configurar tratamento de erros

### **Testes**
- [ ] Testes unit√°rios do backend
- [ ] Testes de integra√ß√£o
- [ ] Testes E2E do frontend
- [ ] Testes de performance
- [ ] Testes de seguran√ßa

### **Deploy**
- [ ] Configurar ambiente de produ√ß√£o
- [ ] Configurar CI/CD
- [ ] Configurar backup do banco
- [ ] Configurar monitoramento
- [ ] Documentar procedimentos

---

## ‚ö†Ô∏è **Riscos e Mitiga√ß√µes**

### **Riscos T√©cnicos**
1. **Incompatibilidade de dados**
   - **Mitiga√ß√£o:** Criar scripts de migra√ß√£o e valida√ß√£o

2. **Performance do Oracle**
   - **Mitiga√ß√£o:** Otimizar queries e criar √≠ndices adequados

3. **Problemas de conectividade**
   - **Mitiga√ß√£o:** Implementar pool de conex√µes e retry logic

### **Riscos de Neg√≥cio**
1. **Downtime durante migra√ß√£o**
   - **Mitiga√ß√£o:** Migra√ß√£o gradual e rollback plan

2. **Perda de funcionalidades**
   - **Mitiga√ß√£o:** Testes extensivos e valida√ß√£o com usu√°rios

---

## üìà **Cronograma Estimado**

| Fase | Dura√ß√£o | Depend√™ncias |
|------|---------|-------------|
| 1. Prepara√ß√£o | 5 dias | - |
| 2. Modelagem BD | 3 dias | Fase 1 |
| 3. APIs | 10 dias | Fase 2 |
| 4. Frontend | 5 dias | Fase 3 |
| 5. Autentica√ß√£o | 3 dias | Fase 3, 4 |
| 6. Testes/Deploy | 4 dias | Todas anteriores |

**Total Estimado:** 30 dias √∫teis (6 semanas)

---

## üí∞ **Recursos Necess√°rios**

### **Infraestrutura**
- Servidor Oracle 19c configurado
- Servidor de aplica√ß√£o (Node.js)
- Servidor web (Nginx)
- Ambiente de desenvolvimento

### **Equipe**
- 1 Desenvolvedor Backend (Node.js + Oracle)
- 1 Desenvolvedor Frontend (React)
- 1 DBA (configura√ß√£o e otimiza√ß√£o)
- 1 DevOps (deploy e monitoramento)

---

**üìù Este plano fornece uma base s√≥lida para a migra√ß√£o completa do sistema mock para APIs REST com Oracle 19c, mantendo todas as funcionalidades existentes e adicionando robustez empresarial.**