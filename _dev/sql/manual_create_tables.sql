-- Execute este script manualmente no SQL Developer ou sqlplus
-- Conecte-se primeiro como protocolo_user

-- Criar tabela ENCOMENDAS
CREATE TABLE ENCOMENDAS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NUMERO_ENCOMENDA VARCHAR2(50) NOT NULL UNIQUE,
    DESCRICAO CLOB,
    STATUS VARCHAR2(20) DEFAULT 'PENDENTE',
    DATA_CRIACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DATA_ATUALIZACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    USUARIO_ID NUMBER,
    SETOR_ID NUMBER,
    CONSTRAINT FK_ENCOMENDA_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS(ID),
    CONSTRAINT FK_ENCOMENDA_SETOR FOREIGN KEY (SETOR_ID) REFERENCES SETORES(ID)
);

-- Criar tabela DOCUMENTOS
CREATE TABLE DOCUMENTOS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME_ARQUIVO VARCHAR2(255) NOT NULL,
    CAMINHO_ARQUIVO VARCHAR2(500) NOT NULL,
    TIPO_ARQUIVO VARCHAR2(50),
    TAMANHO_ARQUIVO NUMBER,
    DATA_UPLOAD TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PROCESSO_ID NUMBER,
    USUARIO_ID NUMBER,
    CONSTRAINT FK_DOCUMENTO_PROCESSO FOREIGN KEY (PROCESSO_ID) REFERENCES PROCESSOS(ID),
    CONSTRAINT FK_DOCUMENTO_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS(ID)
);

-- Criar tabela PRAZOS
CREATE TABLE PRAZOS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESCRICAO VARCHAR2(255) NOT NULL,
    DATA_INICIO DATE NOT NULL,
    DATA_FIM DATE NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'ATIVO',
    PROCESSO_ID NUMBER,
    USUARIO_RESPONSAVEL_ID NUMBER,
    DATA_CRIACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_PRAZO_PROCESSO FOREIGN KEY (PROCESSO_ID) REFERENCES PROCESSOS(ID),
    CONSTRAINT FK_PRAZO_USUARIO FOREIGN KEY (USUARIO_RESPONSAVEL_ID) REFERENCES USUARIOS(ID)
);

-- Criar tabela CONFIGURACOES
CREATE TABLE CONFIGURACOES (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CHAVE VARCHAR2(100) NOT NULL UNIQUE,
    VALOR CLOB,
    DESCRICAO VARCHAR2(255),
    TIPO VARCHAR2(50) DEFAULT 'STRING',
    DATA_CRIACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DATA_ATUALIZACAO TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Criar índices
CREATE INDEX IDX_ENCOMENDAS_NUMERO ON ENCOMENDAS(NUMERO_ENCOMENDA);
CREATE INDEX IDX_ENCOMENDAS_STATUS ON ENCOMENDAS(STATUS);
CREATE INDEX IDX_DOCUMENTOS_PROCESSO ON DOCUMENTOS(PROCESSO_ID);
CREATE INDEX IDX_PRAZOS_PROCESSO ON PRAZOS(PROCESSO_ID);
CREATE INDEX IDX_PRAZOS_DATA_FIM ON PRAZOS(DATA_FIM);
CREATE INDEX IDX_CONFIGURACOES_CHAVE ON CONFIGURACOES(CHAVE);

-- Inserir configurações padrão
INSERT INTO CONFIGURACOES (CHAVE, VALOR, DESCRICAO, TIPO) VALUES 
('SISTEMA_NOME', 'Sistema de Protocolo', 'Nome do sistema', 'STRING');

INSERT INTO CONFIGURACOES (CHAVE, VALOR, DESCRICAO, TIPO) VALUES 
('PRAZO_PADRAO_DIAS', '30', 'Prazo padrão em dias para processos', 'NUMBER');

INSERT INTO CONFIGURACOES (CHAVE, VALOR, DESCRICAO, TIPO) VALUES 
('EMAIL_NOTIFICACAO', 'admin@protocolo.com', 'Email para notificações do sistema', 'STRING');

COMMIT;

-- Verificar tabelas criadas
SELECT table_name FROM user_tables WHERE table_name IN ('ENCOMENDAS', 'DOCUMENTOS', 'PRAZOS', 'CONFIGURACOES') ORDER BY table_name;